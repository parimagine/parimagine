<!doctype html>
<!--[if IEMobile 7 ]> <html lang="en-US"class="no-js iem7"> <![endif]-->
<!--[if lt IE 7 ]> <html lang="en-US" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en-US" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en-US" class="no-js ie8"> <![endif]-->
<!--[if (gte IE 9)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!-->
<html lang="en-US" ><!--<![endif]-->
  <head>
    <meta charset="UTF-8" />
    <meta name="google" content="notranslate">
    <meta http-equiv="Content-Language" content="en" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta property="og:url" content=""/>
    <meta property="og:title" content=""/>
    <meta property="og:description" content=""/>
    <meta property="og:image" content=""/>
    <meta property="og:type" content="website"/>
    <title>parimagine</title>
        
    <meta name="HandheldFriendly" content="True"/>
    <meta name="MobileOptimized" content="320"/>

    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    
    <!-- media-queries.js (fallback) -->
    <!--[if lt IE 9]>
      <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>     
    <![endif]-->

    <!-- html5.js -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="style.css" />
  </head>
  
  <body>

    <section id="content" style="">

      <div id="container" style="visiblity:hidden; margin: 0 auto;" class="clearfix">

      </div>

    </section> 

    <a id="next" href="#">more</a>

  </body>
</html>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.js"></script>
<!-- script src="//cdnjs.cloudflare.com/ajax/libs/jquery-infinitescroll/2.0b2.110713/jquery.infinitescroll.min.js"></script-->
<script src="https://raw.github.com/paulirish/infinite-scroll/master/jquery.infinitescroll.js"></script>
<!--script src="//cdnjs.cloudflare.com/ajax/libs/masonry/2.1.08/jquery.masonry.min.js"></script-->
<script src="http://masonry.desandro.com/jquery.masonry.js"></script>
<script type="text/javascript">
$(function(){

  // var server = "http://localhost:1212/geppaequo-fileupload/documents";
  // var server = "SiteParimagine/Piwi/galleries";
  var server = "https://parimaginep1894179457trial.hanatrial.ondemand.com/parimagine/documents";

  var $container = $('#container');
  var $container_needs_init = true;
  
  function my_masonry_init() {
    if ($container_needs_init) {
      $container.masonry({
        itemSelector : '.box',
        columnWidth : 80,
        isFitWidth: true,
        // isAnimated: true
      });
      $container.css({visibility:"visible"});
      $container_needs_init = false;
    }
  }

  $.ajax(
    {
        type        : 'GET',
        dataType    : "json",
        url         : "photos_encore_moins.json",
    }).done(function( data, textStatus, jqXHR ) {
      $.each(data, function() {
        var size = 2 /*3+Math.round(1*Math.random())*/;
        // console.log(size);
        $container.append('<div class="box col'+size+'" href="'+server+this+'"><img src="'+server+this+'" ><div>blablabla</div></div>');
      });    

      $container.imagesLoaded(function(){
        my_masonry_init();
      });

      $container.infinitescroll(
        {
          navSelector  : "a#next:last",   // selector for the paged navigation (it will be hidden)
          nextSelector : "a#next:last",   // selector for the NEXT link (to page 2)

          dataType: 'json',
          appendCallback: false,
          prefill: true,
          path : function(current) {
            return "photos_encore_moins.json";
          },
          itemSelector : '.box',     // selector for all items you'll retrieve
          loading: {
            speed: 0,
            img: 'ajax-loader.gif',
            finishedMsg: '',
            msgText: '',
          },
              }, function(data, opts) {
          var page = opts.state.currPage; 
          console.log(page);
          var newElements = [];
          $.each(data, function() {
            var size = 2/* + Math.round(2*Math.random())*/;
            var newElement = $('<a class="box col'+size+'" href="'+server+this+'" style="opacity: 0;"><img src="'+server+this+'" ><div>blablabla</div></a>').get()[0];
            newElements.push(newElement);
          });
          // hide new items while they are loading
          // var $newElems = $container.append(newElements).css({ opacity: 1 });
          // ensure that images load before adding to masonry layout
          var doms = $(newElements);
          doms.imagesLoaded(function(){
            my_masonry_init(); // will not reload
            // show elems now they're ready
            doms.css({ opacity: 1 });
            $container.masonry( 'appended', doms, true ); 
          });
          $container.append(doms);
          $("#next").show();
          return false;
        }
      );      

    }).fail(function(jqXHR, textStatus, errorThrown){
        console.log(errorThrown);
    }
  );

});  

</script>
